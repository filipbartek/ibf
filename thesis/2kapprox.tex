\chapter{\texorpdfstring{$2k$}{2k}-approximation algorithm
for \texorpdfstring{$k$}{k}-interval functions}
\label{chap:2kapprox}

\todo[inline]{Put the chapter in the context of the preceding chapters.}

In this chapter,
an algorithm will be shown that computes
a small spanning set
of any $k$-interval Boolean function.
The input intervals are represented by pairs of endpoints
($n$-bit numbers).
An approximation ratio of $2k$ will be proved.

We will only consider
proper $k$-interval Boolean functions,
that is those whose adjacent intervals are separated by
at least one false point
(see Definition \ref{def:properkibf}).
A $k$-interval Boolean function
which is not proper $k$-interval
can be efficiently reduced to a proper $l$-interval
where $l < k$
by joining the touching adjacent intervals.

\section{Algorithm}

\subsection{Description}

\begin{description}
\item[Input] Numbers $a_1, b_1, \ldots, a_k, b_k$
such that
$\rep{0}{n} \leq a_1$,
$a_1 \leq b_1$,
$b_1 < a_2 - 1$,
\ldots,
$a_i \leq b_i$,
$b_i < a_{i+1} - 1$
(for $i \in \curly{1, \ldots, k-1}$),
\ldots,
$b_{k-1} < a_k - 1$,
$a_k \leq b_k$,
$b_k \leq \rep{1}{n}$.

\item[Output] A set of ternary vectors
\end{description}

\paragraph{Procedure}
The algorithm goes through
all the intervals $\interval{a_i}{b_i}$.
For each $i$, the longest common prefix of $a_i$ and $b_i$
is computed. Let $j$ be its length.
Note that $\bit{a}{j+1} = 0$ and $\bit{b}{j+1} = 1$.
Now let $a'' = \bits{a_i}{j+2}{n}$
and $b'' = \bits{b_i}{j+2}{n}$.
Optimally span the suffix interval
$\interval{a''}{1^{n-j-1}}$
and the prefix interval
$\interval{0^{n-j-1}}{b''}$
using the (linear time) algorithm
introduced in Section \ref{sec:prefixsuffix}.
Prepend $\bits{a_i}{1}{j+1}$
and $\bits{b_i}{1}{j+1}$
to the respective ternary vectors
and add them to the output spanning set.

\todo[inline]{Treat (explicitly) the degenerate cases:
$a_1 = 0$,
$b_k = 2^n - 1$,
$j = n$,
$j = n - 1$.}

\subsection{Feasibility}
\begin{theorem}
The algorithm spans exactly
$f^n_{\interval{a_1}{b_1}, \ldots, \interval{a_k}{b_k}}$.
\end{theorem}

\begin{proof}
This is easy to see from the fact that the intervals
$\interval{a_i}{b_i}$
form a partition of the true point set
and that each of them is spanned exactly
by the suffix and prefix procedure.
\todo{Go into more detail.}
\end{proof}

\subsection{Approximation ratio}
\begin{theorem}
\label{theorem:2kapproxratio}
Let $\mathcal{T}_{opt}$ be an optimal spanning set of
$f^n_{\interval{a_1}{b_1}, \ldots, \interval{a_k}{b_k}}$
and let $\mathcal{T}_{approx}$ be the spanning set returned
by the algorithm.
We claim that:
\begin{equation*}
|\mathcal{T}_{approx}| \leq 2k |\mathcal{T}_{opt}|
\end{equation*}
\end{theorem}

\begin{proof}
Let $\mathcal{T}_x$ be the largest ($n$-bit) spanning set
of a \quot{suffix} or \quot{prefix} subinterval
\todo{Clarify: the interval is prefix or suffix
on $n - j - 1$ bits, but not in general on $n$ bits.}
added in the algorithm.
Without loss of generality,
let the respective subinterval be \quot{prefix}
$\interval{\bits{b_i}{1}{j+1} \rep{0}{n-j-1}}{b_i}$.
From Section \ref{sec:prefixsuffix} we know that
there is an orthogonal set of
$\interval{\bits{b_i}{1}{j+1} \rep{0}{n-j-1}}{b_i}$
of size $|\mathcal{T}_x|$,
and moreover that its orthogonality only depends
on the false point $b_i + 1$.
Note, however, that $b_i + 1$ is also a false point in
$f^n_{\interval{a_1}{b_1}, \ldots, \interval{a_k}{b_k}}$
since $b_i < a_{i+1} - 1$.
Thus we obtain an orthogonal set of size $|\mathcal{T}_x|$
for the $k$-interval function,
limiting the size of its optimal spanning set
$|\mathcal{T}_{opt}| \geq |\mathcal{T}_x|$
by \autoref{theorem:orthodnf}.

Since $\mathcal{T}_x$ is the largest
of the $2k$ partial sets used to span the function
in the approximation algorithm,
we know that
$|\mathcal{T}_{approx}| \leq 2k |\mathcal{T}_x|$.

Joining the inequalities together we conclude:

\begin{equation*}
|\mathcal{T}_{approx}| \leq 2k |\mathcal{T}_x| \leq
2k |\mathcal{T}_{opt}|
\end{equation*}
\end{proof}

Note that the spanning set returned by the algorithm
is disjoint.
This makes the algorithm $2k$-approximation
for the disjoint case as well:

\begin{theorem}
Let $\mathcal{T}_{disjoint}$ be an optimal \emph{disjoint}
spanning set of
$f^n_{\interval{a_1}{b_1}, \ldots, \interval{a_k}{b_k}}$
and let $\mathcal{T}_{approx}$ be the (disjoint)
spanning set returned by our algorithm.
We claim that:
\begin{equation*}
|\mathcal{T}_{approx}| \leq 2k |\mathcal{T}_{disjoint}|
\end{equation*}
\end{theorem}

\begin{proof}
Since every disjoint spanning set
is a spanning set in general,
$\size{\mathcal{T}_{disjoint}} \geq
\size{\mathcal{T}_{opt}}$,
where $\mathcal{T}_{opt}$ is an optimal
(not necessarily disjoint)
spanning set of
$f^n_{\interval{a_1}{b_1}, \ldots, \interval{a_k}{b_k}}$.

Using Theorem \ref{theorem:2kapproxratio} we get:

\begin{equation*}
|\mathcal{T}_{approx}| \leq 2k |\mathcal{T}_{opt}|
\leq k |\mathcal{T}_{disjoint}|
\end{equation*}
\end{proof}

\begin{theorem}
The approximation ratio of $2k$ is tight.
\end{theorem}

\begin{proof}
For every $k$ that is a power of $2$
we'll show a $k$-interval function such that
$|\mathcal{T}_{approx}| = 2k |\mathcal{T}_{opt}|$
(following the notation from
Theorem~\ref{theorem:2kapproxratio}).

Let $k = 2^{n_k}$.
Let $P$ be all the $n_k$-bit numbers,
that is $P = \booldom^{n_k}$.
Note that $|P| = 2^{n_k} = k$.

For each $p \in P$,
we define the interval $\interval{a_p}{b_p}$
by appending $2$-bit suffixes to $p$:

\begin{itemize}
\item $a_p = p 0 0$
\item $b_p = p 0 1$
\end{itemize}

The first appended bit ($0$ for both $a_p$ and $b_p$)
ensures that there is at least one false point
between any pair of intervals defined this way
(all the points that have $1$ in their $(n_k + 1)$-st
component are false points).
The second appended bit ($0$ for $a_p$ and $1$ for $b_p$)
ensures that the interval has two points,
so the approximation algorithm will use two vectors
to span it.
Thus we have $k$ intervals
on $(n_k + 2)$-bit numbers,
none of which intersect or touch.

Since $P = \booldom^{n_k}$,
we can span all the intervals by the single ternary vector
$\rep{\phi}{n_k} 0 \phi$.
Clearly $|\mathcal{T}_{opt}| = 1$.

However,
the approximation algorithm uses $2k$ vectors to span
the intervals,
since it spans each of the intervals separately
and uses two vectors for each interval.

We get
$|\mathcal{T}_{approx}| = 2k |\mathcal{T}_{opt}|$.

Note that the optimal spanning set is disjoint,
so the ratio is tight in disjoint case as well.
\end{proof}
