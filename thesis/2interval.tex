\chapter{\texorpdfstring{$2$}{2}-interval functions}
\label{chap:2interval}

In this chapter we will revise the results specific to
$2$-interval functions.
\citet{Dubovsky2012}
provides more detailed overview.

\citeauthor{Dubovsky2012} identified several classes
of $2$-interval functions \citep[p.~5]{Dubovsky2012}
which seem to require different approaches to spanning.\todo{Reword \quot{seem to require}.}
It turns out that it is useful to consider
the number of so-called switches
to differentiate between these classes.
The concept of switch was introduced by
\citet{Husek2014,Husek2015}.\footnote{
\citeauthor{Husek2014} first used the Czech term
\quot{\foreignlanguage{czech}{zlom}}
in his thesis \citep[p.~13]{Husek2014}
and later translated the term as \quot{switch}
in personal communication \citep{Husek2015}.
}

\begin{definition}[$l$-switch function]
\todomaybe{Move definition to Definitions if the term is used in any chapter except \texttt{2interval}.}
A Boolean function $f$ is \definiendum{$l$-switch}
if and only if
there are exactly $l$ input vectors $x$ such that
$f(x) \neq f(x+1)$.
\end{definition}

It is easy to see that
prefix and suffix interval functions are $1$-switch.

Depending on $f(0)$,
an $l$-switch Boolean function $f$
is $\ceil*{\frac{l}{2}}$-interval in case $f(0) = 0$,
% f(0) = 0:
% 1-switch: 1-interval
% 2-switch: 1-interval
% 3-switch: 2-interval
% 4-switch: 2-interval
% l-switch: \ceil{l/2}-interval
or $\ceil*{\frac{l+1}{2}}$-interval in case $f(0) = 1$.
% f(0) = 1:
% 1-switch: 1-interval
% 2-switch: 2-interval
% 3-switch: 2-interval
% 4-switch: 3-interval
% l-switch: \ceil{(l+1)/2}-interval
\todomaybe{Add \quot{Equivalently, a $k$-interval function is [?]-switch in case \ldots}}

Namely,
a $2$-switch Boolean function such that $f(0) = 0$
is $1$-interval.

\section{\texorpdfstring{$2$}{2}-switch functions}

\newcommand{\ftwointtwoswitch}[4]
{#1^{#2}_{\interval{\rep{0}{#2}}{#3},
\interval{#4}{\rep{1}{#2}}}}

\newcommand{\fnba}{\ftwointtwoswitch{f}{n}{b_1}{a_2}}

Let $f$ be a $2$-interval $2$-switch Boolean function
(necessarily $f(\rep{0}{n}) = f(\rep{1}{n})
= 1$).\footnote{This corresponds to class $A_0$
in \citeauthor{Dubovsky2012}'s classification
\citep[p.~5]{Dubovsky2012}.}
We will show that $f$
can be optimally spanned by reduction to
a $2$-switch $1$-interval Boolean function $f'$
of at most the same arity,
which can be spanned using the algorithm introduced
in chapter \ref{chap:1interval}.

Note that
\citeauthor{Dubovsky2012} introduced an optimization algorithm for
this class of functions \citep[section 3.2]{Dubovsky2012},
following an argument similar to the one used by
\citeauthor{Schieber2005154} to span $1$-interval functions
\citep{Schieber2005154}.
However,
the reduction approach gives
an interesting insight in the problem
and seems easier to describe.
% TODO: Consider rewording.

From the definition of $f$ we know that it is $2$-interval
with the outer interval endpoints being
$\rep{0}{n}$ and $\rep{1}{n}$:

\[
f = \fnba
\]

Let's call the inner interval endpoints $b_1$ and $a_2$.
$\rep{0}{n} \leq b_1$,
$b_1 < a_2 - 1$ ($f$ is proper $2$-interval
-- otherwise it would be a tautology
and thus trivial to span),
$a_2 \leq \rep{1}{n}$.

\subsection{\texorpdfstring{$\bit{b_1}{1} = \bit{a_2}{1}$}
{b1[1] = a2[1]}
}

In case $b_1$ and $a_2$ have the same \acrshort{msb}s,
we recursively solve the $(n-1)$-bit
case
$\interval{\rep{0}{n-1}}{\bits{b_1}{2}{n}},
\interval{\bits{a_2}{2}{n}}{\rep{1}{n-1}}$,
and add an extra ternary vector to span the remainder
of the true points.

Without loss of generality,
let $\bit{b_1}{1} = \bit{a_2}{1} = 0$.
The complementary case is symmetric.

Let $b_1' = \bits{b_1}{2}{n}$
and $a_2' = \bits{a_2}{2}{n}$.
Let $\mathcal{T}_0'$ be an optimal spanning set of
$f' = \ftwointtwoswitch{f}{n-1}{b_1'}{a_2'}$.
Note that $f'$ is of the same type
(that is $2$-interval $2$-switch)
and has a lower arity,
so we can span it by recursion.
Let $\mathcal{T}_0$ be the $n$-bit set we get
by prepending the symbol $0$
to each vector from $\mathcal{T}_0'$
($\mathcal{T}_0 = \curly{0 T | T \in \mathcal{T}_0'}$).
Let $\mathcal{T}_1 = \curly{1 \rep{\phi}{n-1}}$.
Let $\mathcal{T} = \mathcal{T}_0 \cup \mathcal{T}_1$.
We claim that $\mathcal{T}$ spans exactly
$\fnba$
and that $\mathcal{T}$ is minimum such.

\begin{theorem}
$\mathcal{T}$ spans exactly
$\fnba$ (feasibility).
\end{theorem}

\begin{proof}
\hfill % Break line to align the enumerate items
\begin{enumerate}
\item{$span(\mathcal{T}) \subseteq TP(f)$}

Let $c \in span(T)$, $T \in \mathcal{T}$.
We need to show that $c \leq b_1$ or $c \geq a_2$.

\begin{enumerate}
\item $\bit{c}{1} = 1$: Since $\bit{a_2}{1} = 0$,
necessarily $c \geq a_2$.

\item $\bit{c}{1} = 0$: Necessarily $T \in \mathcal{T}_0$.
Let $T' = \bits{T}{2}{n}$ and $c' = \bits{c}{2}{n}$.
Since $T$ spans $c$, $T'$ spans $c'$.
By construction of $\mathcal{T}_0$
necessarily $T' \in \mathcal{T}_0'$,
so $T'$ does not span any number
in $\interval{b_1' + 1}{a_2' - 1}$.
Thus $c' \leq b_1'$ or $c' \geq a_2'$.
Observe that prepending a $0$ bit
to $c'$, $b_1'$ and $a_2'$
preserves the inequalities:
\[
c' \leq b_1' \text{ or } c' \geq a_2'
\Rightarrow
0 c' \leq 0 b_1' \text{ or } 0 c' \geq 0 a_2'
\]

Since $0 c' = c$, $0 a' = a$ and $0 b' = b$,
we get $c \leq b_1$ or $c \geq a_2$.
% meaning f(c) = 1
\end{enumerate}

\item{$TP(f) \subseteq span(\mathcal{T})$}

Let $c \leq b_1$ or $c \geq a_2$.
We need a $T \in \mathcal{T}$ that spans $c$.

\begin{enumerate}
\item $\bit{c}{1} = 1$:
$1 \phi^{n-1} \in \mathcal{T}_1 \subseteq \mathcal{T}$
spans $c$.

\item $\bit{c}{1} = 0$:
Similarly to $b_1'$ and $a_2'$, let $c' = \bits{c}{2}{n}$.
Since $b_1$, $a_2$ and $c$ all start with a $0$ bit,
$c' \leq b_1'$ or $c' \geq a_2'$.
Since $\mathcal{T}_0'$ spans
$\ftwointtwoswitch{f}{n-1}{b_1'}{a_2'}$,
there is $T \in \mathcal{T}_0'$ that spans $c'$.
Prepending the symbol $0$ to both $T$ and $c'$
preserves spanning,
so $0 T \in \mathcal{T}_0 \subseteq \mathcal{T}$ spans $c$.
\end{enumerate}

\end{enumerate}
\end{proof}

\begin{theorem}
$\mathcal{T}$ is a minimum spanning set of
$\fnba$ (optimality).
\end{theorem}

\begin{proof}
Let $\mathcal{T}_{opt}$ be an optimal spanning set of
$\fnba$.
We'll show that
$\size{\mathcal{T}_{opt}} \geq \size{\mathcal{T}}$.

First recall that
$\mathcal{T}_0'$ is an optimal spanning set of
$\ftwointtwoswitch{f}{n-1}{b_1'}{a_2'}$
and
$\size{\mathcal{T}} = \size{\mathcal{T}_0'} + 1$.
Thus we need to show
$\size{\mathcal{T}_{opt}} \geq \size{\mathcal{T}_0'} + 1$

$\mathcal{T}_{opt}$ must span the true point
$\bar{b}_1 = 1 \bits{(b_1 + 1)}{2}{n}$.
We don't need more than $n$ bits for $\bar{b}_1$
because $b_1 < a_2 \leq 0 \rep{1}{n-1}$.
Let $T_{\bar{b}_1} \in \mathcal{T}_{opt}$
be a ternary vector that spans $\bar{b}_1$.
If $T_{\bar{b}_1}$ spanned
any vector that starts with a $0$,
then $T_{\bar{b}_1}$ would also span
the vector $b_1 + 1$.
However,
since $f$ is \emph{proper} $2$-interval,
$b_1 + 1$ is a false point ($b_1 < b_1 + 1 < a_2$).
So $T_{\bar{b}_1}$
can't span any vector that starts with a $0$.

To get a contradiction,
let's suppose that
$\size{\mathcal{T}_{opt}} \leq \size{\mathcal{T}_0'}$.
Since we need a dedicated vector
$T_{\bar{b}_1} \in \mathcal{T}_{opt}$ to span $\bar{b}_1$,
there are at most
$\size{\mathcal{T}_{opt}} - 1
\leq \size{\mathcal{T}_0'} - 1$
vectors in $\mathcal{T}_{opt}$ that span a number
that starts with $0$
(so these vectors start with $0$ or $\phi$).
Removing the first symbol of these vectors,
we get a spanning set of
$\ftwointtwoswitch{f}{n-1}{b_1'}{a_2'}$
of size at most $\size{\mathcal{T}_0'} - 1$,
which contradicts $\mathcal{T}_0'$'s optimality.

We conclude that we need at least
$\size{\mathcal{T}_0'} + 1$ vectors to span
$\fnba$,
proving the lower bound of
$\size{\mathcal{T}_{opt}}$
and the optimality of $\mathcal{T}$.
\end{proof}

We have shown that in case $\bit{b_1}{1} = \bit{a_2}{1}$,
our algorithm produces a feasible and optimal spanning set.

\subsection{\texorpdfstring{$\bit{b_1}{1}
\neq \bit{a_2}{1}$}
{b1[1] != a2[1]}
% TODO: Use a better text symbol for inequality.
}

Let $\bit{b_1}{1} \neq \bit{a_2}{1}$.
Since $b_1 \leq a_2$,
necessarily $\bit{b_1}{1} = 0$ and $\bit{a_2}{1} = 1$.

By flipping the leading bit in each of the endpoints
$b_1$ and $a_2$,
we will reduce this case
to an instance of spanning a single true point interval
on $n$ bits.
% TODO: Rephrase.

%Let $a_1 = a - 1$ and $b_1 = b + 1$.

Let $b_1' = 1 \bits{b_1}{2}{n}$
and $a_2' = 0 \bits{a_2}{2}{n}$
(flipping the leading bits of $b_1$ and $a_2$).
Note that $a_2' \leq b_1'$.

Let $\mathcal{T}'$ be a minimum spanning set
of $\intervalfn{f}{n}{a_2'}{b_1'}$.
This set can be computed efficiently
using the method shown
in chapter \ref{chap:1interval}.

Let's flip all the non-$\phi$ leading symbols
of vectors in $\mathcal{T}'$,
forming $\mathcal{T}$.
Note that $\size{\mathcal{T}} = \size{\mathcal{T}'}$
and also that all the vectors in $\mathcal{T}'$
and $\mathcal{T}$ have the length $n$.

We claim that $\mathcal{T}$ is a minimum spanning set
of $\fnba$.

The argument is based on a pair of lemmas.

\begin{lemma}
\label{lemma:cflip}
Let $c$ be an $n$-bit binary vector
and $a, b$ be $(n-1)$-bit binary vectors.
Let $c' = \compl{\bit{c}{1}} \bits{c}{2}{n}$
(flipping the leading bit of $c$).
Then ($c \leq 0 b$ or $c \geq 1 a$)
if and only if
($c' \geq 0 a$ and $c' \leq 1 b$).
\end{lemma}

\begin{proof}
\hfill % Break line to align the enumerate items
\begin{enumerate}
\item $\bit{c}{1} = 0$:

Let $c = 0 \bits{c}{2}{n}$ and $c' = 1 \bits{c}{2}{n}$.

Since $\bit{c}{1} = 0$,
$c \ngeq 1 a$.
Thus ($c \leq 0 b$ or $c \geq 1 a$)
if and only if
$c \leq 0 b$.

Since $\bit{c}{1} = 0$,
$c \leq 0 b$
if and only if
$\bits{c}{2}{n} \leq b$.

Since $\bit{c'}{1} = 1$
and $\bits{c'}{2}{n} = \bits{c}{2}{n}$,
$\bits{c}{2}{n} \leq b$
if and only if
$c' \leq 1 b$.

From $\bit{c'}{1} = 1$ we immediately get $c' \geq 0 a$.

Chaining the equivalences together:
\begin{align*}
c \leq 0 b \text{ or }c \geq 1 a
&\iff c \leq 0 b \\
&\iff \bits{c}{2}{n} \leq b \\
&\iff c' \leq 1 b \\
&\iff c' \leq 1 b \text{ and } c' \geq 0 a
\end{align*}

\item $\bit{c}{1} = 1$:

This case is symmetric to the previous one.

\end{enumerate}
\end{proof}

\begin{lemma}
\label{lemma:tflip}
Let $\mathcal{T}$ be a set of ternary vectors
and $\mathcal{T}'
= \curly{\compl{\bit{T}{1}} \bits{T}{2}{n}
|T \in \mathcal{T}}$.
Let $a, b$ be any $(n-1)$-bit binary vectors.
% such that $0 b \leq 1 a - 2$.
Then $\mathcal{T}$ spans $\ftwointtwoswitch{f}{n}{0 b}{1 a}$
if and only if
$\mathcal{T}'$ spans
$\intervalfn{f}{n}{0 a}{1 b}$.\footnote{Note that
the statement holds even in the single case that
the function is not proper $2$-interval,
that is $a = \rep{1}{n-1}$ and $b = \rep{0}{n-1}$.}
% TODO: Add "However, we won't use this case."
\end{lemma}

\begin{proof}
\hfill % Break line to align the enumerate items
% TODO: Prevent page break here.
\begin{enumerate}
\item
If $\mathcal{T}$ spans $\ftwointtwoswitch{f}{n}{0 b}{1 a}$,
then $\mathcal{T}'$ spans $\intervalfn{f}{n}{0 a}{1 b}$:

Let $\mathcal{T}$ span $\ftwointtwoswitch{f}{n}{0 b}{1 a}$.

Let $c'$ be an $n$-bit binary vector.
We need to show that
$\mathcal{T}'$ spans $c'$
if and only if
$c' \geq 0 a$ and $c' \leq 1 b$.

Let $c = \compl{\bit{c'}{1}} \bits{c'}{2}{n}$.
By definition of $\mathcal{T}'$,
$\mathcal{T}'$ spans $c'$
if and only if
$\mathcal{T}$ spans $c$.

Since $\mathcal{T}$ spans
$\ftwointtwoswitch{f}{n}{0 b}{1 a}$,
$\mathcal{T}$ spans $c$
if and only if
$c \leq 0 b$ or $c \geq 1 a$.

From Lemma \ref{lemma:cflip}
we get ($c \leq 0 b$ or $c \geq 1 a$)
if and only if
($c' \geq 0 a$ and $c' \leq 1 b$).

Chaining the equivalences together:
\begin{align*}
\mathcal{T}' \text{ spans } c' &\iff \mathcal{T} \text{ spans } c \\
&\iff c \leq 0 b \text{ or } c \geq 1 a \\
&\iff c' \geq 0 a \text{ and } c' \leq 1 b \\
&\iff \intervalfn{f}{n}{0 a}{1 b}(c') = 1
\end{align*}

\item
If $\mathcal{T}'$ spans $\intervalfn{f}{n}{0 a}{1 b}$,
then $\mathcal{T}$ spans $\ftwointtwoswitch{f}{n}{0 b}{1 a}$:

Let $\mathcal{T}'$ span $\intervalfn{f}{n}{0 a}{1 b}$.

Let $c$ be an $n$-bit binary vector.
We need to show that $\mathcal{T}$ spans $c$
if and only if
$c \leq 0 b$ or $c \geq 1 a$.

Let $c' = \compl{\bit{c}{1}} \bits{c}{2}{n}$.
By definition of $\mathcal{T}'$,
$\mathcal{T}$ spans $c$
if and only if
$\mathcal{T}'$ spans $c'$.

Since $\mathcal{T}'$ spans $\intervalfn{f}{n}{0 a}{1 b}$,
$\mathcal{T}'$ spans $c'$
if and only if
$c' \geq 0 a$ and $c' \leq 1 b$.

Using Lemma \ref{lemma:cflip},
we get
($c' \geq 0 a$ and $c' \leq 1 b$)
if and only if
($c \leq 0 b$ or $c \geq 1 a$).

Chaining the equivalences together:
\begin{align*}
\mathcal{T} \text{ spans } c
&\iff \mathcal{T}' \text{ spans } c' \\
&\iff c' \geq 0 a \text{ and } c' \leq 1 b \\
&\iff c \leq 0 b \text{ or } c \geq 1 a \\
&\iff \ftwointtwoswitch{f}{n}{0 b}{1 a}(c) = 1
\end{align*}

\end{enumerate}
\end{proof}

Lemma \ref{lemma:tflip} shows
a size preserving
bijection
\todomaybe{Consider rewording,
e.g.~\quot{one-to-one correspondence}
or \quot{correspondence}.}
between
the spanning sets of functions of form
$\ftwointtwoswitch{f}{n}{0 b}{1 a}$
and $\intervalfn{f}{n}{0 a}{1 b}$
for general $a$ and $b$.
Since $b_1$ starts with a $0$ ($b_1 = 0 b$),
$a_2$ starts with a $1$ ($a_2 = 1 a$)
and the set $\mathcal{T}$ was constructed
from an optimal spanning set $\mathcal{T}'$
of
$\intervalfn{f}{n}{0 \bits{a_2}{2}{n}}{1 \bits{b_1}{2}{n}}$
using the bijection
shown in \ref{lemma:tflip},
that is flipping the leading symbols
of all the ternary vectors,
both feasibility and optimality of $\mathcal{T}$
with respect to $\fnba$
follow from the feasibility and optimality
of $\mathcal{T}'$ with respect to
$\intervalfn{f}{n}{0 \bits{a_2}{2}{n}}{1 \bits{b_1}{2}{n}}$.

\section{\texorpdfstring{$3$}{3}-switch functions}
\label{sec:3switch}

The situation changes in $3$-switch functions.
In $1$-switch (prefix and suffix)
and $2$-switch ($1$-interval and $2$-interval
with extreme outer endpoints\todo{Rephrase.})
functions,
we have implicitly \todo{Make it explicit.}
used so-called orthogonal sets \todo{Cite Dubovsky.}
for proving optimality of the spanning sets
produced by our algorithms.
\todo{Draw connection to \quot{essential sets}.}

However,
\citeauthor{Dubovsky2012} has identified a $3$-switch function
whose maximum orthogonal set is strictly smaller than its
minimum spanning set.
The function is
$f^4_{\interval{0}{4}, \interval{9}{14}}$.
The size of its maximum orthogonal set is 4
and the size of its minimum spanning set is
5.\citep[p.~32]{Dubovsky2012}
\todo{Relate to coverability.}
\todo{Relate to general inequality of size of maximum orthogonal set and size of minimum spanning set.}

\todo[inline]{Try to generalize for larger
number of switches.
Prepend two bits to Dubovsky's example and
add a true point at far right.
This increments size of the spanning set and
size of the orthogonal set
and number of switches.
Iterating increases number of switches by two
-- however, we can also start with Dubovsky's
example of $4$-switch non-coverable function.}

This result indicates that minimizing the \acrshort{dnf}
representation of $3$-switch functions
requires a different approach for proving optimality.
